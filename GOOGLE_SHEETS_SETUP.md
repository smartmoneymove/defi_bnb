# Настройка Google Sheets для логирования

## 1. Создание Google Таблицы

1. Перейдите на [Google Sheets](https://sheets.google.com)
2. Создайте новую таблицу с названием "DeFi Trading Log" (или любое другое)
3. Скопируйте ID таблицы из URL (часть между `/d/` и `/edit`)
4. **Листы создаются автоматически** - каждый сервер создаст свой лист с названием адреса кошелька

### Автоматические заголовки столбцов:
   - A: "Старт" (дата и время начала)
   - B: "Финиш" (дата и время окончания) 
   - C: "Часов" (продолжительность в часах)
   - D: "BTC, старт" (цена BTC на начало)
   - E: "BTC, финиш" (цена BTC на конец)
   - F: "Сумма старт" (общий баланс на начало)
   - G: "Сумма финиш" (общий баланс на конец)
   - H: "Прибыль/Убыток" (изменение баланса)
   - I: "Изменение BTC %" (изменение цены BTC в %)
   - J: "Комментарий" (дополнительная информация)

## 2. Настройка сервисного аккаунта

1. Перейдите в [Google Cloud Console](https://console.cloud.google.com)
2. Создайте новый проект или выберите существующий
3. **ОБЯЗАТЕЛЬНО включите API:**
   - **Google Sheets API:** https://console.developers.google.com/apis/api/sheets.googleapis.com/overview?project=410134711293
   - **Google Drive API:** https://console.developers.google.com/apis/api/drive.googleapis.com/overview?project=410134711293
   - Нажмите "Enable" для каждого API
   - Дождитесь активации (может занять несколько минут)

4. Создайте сервисный аккаунт:
   - Перейдите в "IAM & Admin" → "Service Accounts"
   - Нажмите "Create Service Account"
   - Введите имя (например, "defi-logger")
   - Создайте ключ в формате JSON
   - Скачайте файл и переименуйте в `service-account.json`
   - Поместите файл в корень проекта `/root/defi/`

## 3. Предоставление доступа к таблице

1. Откройте вашу Google таблицу
2. Нажмите "Поделиться" (Share)
3. Добавьте email сервисного аккаунта (из файла service-account.json, поле "client_email")
4. Дайте права "Редактор" (Editor)

## 4. Настройка переменных окружения

В файле `.env` уже добавлены настройки:
```env
GOOGLE_SHEETS_ID="15yp8anIMPNFFqtD5p-YGlg5u8ewUHeDjluKXrCoGrYo"
GOOGLE_SERVICE_ACCOUNT_PATH="service-account.json"
```

**Важно:** Листы создаются автоматически по адресу кошелька из `WALLET_ADDRESS`!

## 5. Установка зависимостей

```bash
pip install -r requirements.txt
```

## 6. Тестирование

Запустите тест модуля:
```bash
cd /root/defi
python src/google_sheets_logger.py
```

## Структура данных

Модуль автоматически записывает:
- **Время начала/окончания** рабочего периода
- **Цену cbBTC** на момент начала и окончания
- **Общий баланс** активов (USDC + cbBTC + CAKE) в USD
- **Продолжительность** рабочего периода в часах

Все данные получаются в реальном времени из блокчейна Base через RPC узел.
