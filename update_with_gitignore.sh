#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º .gitignore
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./update_with_gitignore.sh

set -e  # –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏ –æ—à–∏–±–∫–µ

echo "üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è —Å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –Ω–æ–≤–æ–≥–æ .gitignore..."

# 1. –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (–µ—Å–ª–∏ –µ—Å—Ç—å)
if [[ -n $(git status --porcelain) ]]; then
    echo "üì¶ –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è..."
    git add .
    git commit -m "Save current changes before gitignore update" || true
fi

# 2. –£–¥–∞–ª—è–µ–º —Ñ–∞–π–ª—ã –∏–∑ –∏–Ω–¥–µ–∫—Å–∞, –∫–æ—Ç–æ—Ä—ã–µ —Ç–µ–ø–µ—Ä—å –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è
echo "üßπ –û—á–∏—â–∞–µ–º –∫—ç—à git –æ—Ç –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤..."

# –£–¥–∞–ª—è–µ–º –≤—Å–µ —Ñ–∞–π–ª—ã –∏–∑ –∏–Ω–¥–µ–∫—Å–∞
git rm -r --cached . > /dev/null 2>&1 || true

# –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞—Ç–Ω–æ —Ç–æ–ª—å–∫–æ —Ç–µ —Ñ–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –ù–ï –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è
echo "‚ûï –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞—Ç–Ω–æ –Ω–µ–∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º—ã–µ —Ñ–∞–π–ª—ã..."
git add .

# 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å
echo "üìã –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è .gitignore:"
git status --short

# 4. –ö–æ–º–º–∏—Ç–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è .gitignore
if [[ -n $(git status --porcelain) ]]; then
    echo "üíæ –ö–æ–º–º–∏—Ç–∏–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è .gitignore..."
    git add .gitignore
    git commit -m "feat: update .gitignore with DeFi project structure

- Add crypto/blockchain specific ignores
- Better organize sections with headers  
- Add state files and trading data ignores
- Include wallet and keystore protections
- Add comprehensive OS and IDE coverage"
    
    echo "‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã!"
else
    echo "‚ÑπÔ∏è  –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∫–æ–º–º–∏—Ç–∞"
fi

# 5. –ü–æ–¥—Ç—è–≥–∏–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
echo "‚¨áÔ∏è  –ü–æ–¥—Ç—è–≥–∏–≤–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ —É–¥–∞–ª–µ–Ω–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
if git remote | grep -q origin; then
    # –ü–æ–ª—É—á–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
    git fetch origin
    
    # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â—É—é –≤–µ—Ç–∫—É
    CURRENT_BRANCH=$(git branch --show-current)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ —É–¥–∞–ª–µ–Ω–Ω–∞—è –≤–µ—Ç–∫–∞
    if git branch -r | grep -q "origin/$CURRENT_BRANCH"; then
        echo "üîÑ –ú–µ—Ä–∂–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ origin/$CURRENT_BRANCH..."
        git pull origin $CURRENT_BRANCH --no-edit
        echo "‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ –ø–æ–¥—Ç—è–Ω—É—Ç—ã!"
    else
        echo "‚ö†Ô∏è  –£–¥–∞–ª–µ–Ω–Ω–∞—è –≤–µ—Ç–∫–∞ origin/$CURRENT_BRANCH –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
        echo "üì§ –ü—É—à–∏–º —Ç–µ–∫—É—â—É—é –≤–µ—Ç–∫—É –≤ origin..."
        git push -u origin $CURRENT_BRANCH
    fi
else
    echo "‚ö†Ô∏è  –£–¥–∞–ª–µ–Ω–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω"
fi

# 6. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å
echo ""
echo "üéâ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
echo "üìä –§–∏–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è:"
git status --short

# 7. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏
echo ""
echo "üö´ –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º—ã–µ —Ñ–∞–π–ª—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:"
git status --ignored --short | grep "!!" | head -10
if [[ $(git status --ignored --short | grep "!!" | wc -l) -gt 10 ]]; then
    echo "   ... –∏ –µ—â–µ $(( $(git status --ignored --short | grep "!!" | wc -l) - 10 )) —Ñ–∞–π–ª–æ–≤"
fi

echo ""
echo "‚ú® –ì–æ—Ç–æ–≤–æ! –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –æ–±–Ω–æ–≤–ª–µ–Ω —Å –Ω–æ–≤—ã–º .gitignore" 